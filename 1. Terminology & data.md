## Terminology and Data

 * **OCPI** Open Charge Point Interface
 * **NDR** Notification Detail Record
 * **CDR** Charge Detail Record
 * **CPO** Charging Platform Operator
 * **eMSP** e-Mobility Service Provider


### Charging topology

The charging topology, as relevant to the eMSP, consists of three entities:

* *Connector* is a specific socket or cable available for the EV to make use of.
* *EVSE* is the part that controls the power supply to a single EV in a single session. An EVSE may provide multiple connectors but only one of these can be active at the same time.
* *Location* is a group of one or more EVSE's that belong together geographically or spatially.

![Topology](data/topology.png)

A Location is typically the exact location of one or more EVSE's, but it can also be the entrance of a parking garage or a gated community. It is up to the CPO to use whatever makes the most sense in a specific situation. Once arrived at the location, any further instructions to reach the EVSE from the Location are stored in the EVSE object itself (such as the floor number, visual identification or manual instructions).


### Variable names

In order to prevent issues with Capitals in variable names, the naming in JSON is not CamelCase but camel_case. All variables are lowercase and include an underscore for a space.


### Data types

When defining the cardinality of a field, the following symbols are used during the document:

| Symbol | Description                     | Type     |
|--------|---------------------------------|----------|
| ?      | An optional object.             | Object   |
| 1      | Required object.                | Object   |
| *      | A list of zero or more objects. | [Object] |
| +      | A list of at least one object.  | [Object] |


#### Decimals

Decimals are formatted as strings using "." as decimal separator.

Example:

    0.68
    3.1415

#### DateTime

All timestamps are formatted as string(25) using the combined date and time format from the ISO 8601 standard. The absence of the timezone designator implies a UTC timestamp.

Example:

    2015-06-29T22:39:09+02:00
    2015-06-29T20:39:09Z
    2015-06-29T20:39:09

#### URL's

An URL a string(255) type following the [w3.org spec](http://www.w3.org/Addressing/URL/uri-spec.html).


#### Operator *class*

| Property         | Type         | Card. | Description                        |
|------------------|--------------|-------|------------------------------------|
| name             | string(100)  | 1     | Name of the operator.              |
| website          | URL          | ?     | Link to the operator's website.    |
| logo             | URL          | ?     | Image link to the operator's logo. |


#### Hours *class*

Opening and access hours for the location.

 Field Name             |  Field Type             |  Card.  |  Description
:-----------------------|:------------------------|:--------|:------------
 *Choice: one of two*   |                         |         |
  > regular_hours       |  RegularHoursType       |  *      |  Regular hours, weekday based. Should not be set for representing 24/7 as this is the most common case.
  > twentyfourseven     |  boolean                |  1      |  True to represent 24 hours per day and 7 days per week, except the given exceptions.
 exceptional_openings   |  ExceptionalPeriod      |  *      |  Exceptions for specified calendar dates, time-range based. Periods the station is operating/accessible. Additional to regular hours. May overlap regular rules.
 exceptional_closings   |  ExceptionalPeriod      |  *      |  Exceptions for specified calendar dates, time-range based. Periods the station is not operating/accessible. Overwriting regularHours and exceptionalOpenings. Should not overlap exceptionalOpenings.


##### RegularHours *class*

Regular recurring operation or access hours

 Field Name   |  Field Type  |  Card.  |  Description
:-------------|:-------------|:--------|:------------
 weekday      |  int(1)      |  1      |  Number of day in the week, from Monday (1) till Sunday (7)
 period_begin |  string(5)   |  1      |  Begin of the regular period given in hours and minutes. Must be in 24h format with leading zeros. Example: "18:15". Hour/Minute separator: ":" Regex: $[$0-2$]$$[$0-9$]$:$[$0-5$]$$[$0-9$]$
 period_end   |  string(5)   |  1      |  End of the regular period, syntax as for period_begin. Must be later than period_begin.

##### ExceptionalPeriod *class*

Specifies one exceptional period for opening or access hours.

 Field Name   |  Field Type  |  Card.  |  Description
:-------------|:-------------|:--------|:------------
 period_begin |  DateTime    |  1      |  Begin of the exception.
 period_end   |  DateTime    |  1      |  End of the exception.

##### Example

Operating on Weekdays from 8am till 8pm with one exceptional opening on
22/6/2014 and one exceptional closing the Monday after:

```json
  "operating_times": {
    "regular_hours": [
      {
        "weekday": 1,
        "period_begin": "08:00",
        "period_end": "20:00"
      },
      {
        "weekday": 2,
        "period_begin": "08:00",
        "period_end": "20:00"
      },
      {
        "weekday": 3,
        "period_begin": "08:00",
        "period_end": "20:00"
      },
      {
        "weekday": 4,
        "period_begin": "08:00",
        "period_end": "20:00"
      },
      {
        "weekday": 5,
        "period_begin": "08:00",
        "period_end": "20:00"
      }
    ],
    "exceptional_openings": [
      {
        "period_begin": "2014-06-21T09:00:00Z",
        "period_end": "2014-06-21T12:00:00Z"
      }
    ],
    "exceptional_closings": [
      {
        "period_begin": "2014-06-24T00:00:00Z",
        "period_end": "2014-06-25T00:00:00Z"
      }
    ]
  }
```

This represents the following schedule, where ~~stroked out~~ days are without operation hours, **bold** days are where exceptions apply and regular displayed days are where the regular schedule applies.


| Weekday   | Mo | Tu | We | Th | Fr | Sa     | Su     | Mo | Tu         | We | Th | Fr | Sa     | Su     |
|-----------|----|----|----|----|----|--------|--------|----|------------|----|----|----|--------|--------|
| Date      | 16 | 17 | 18 | 19 | 20 | **21** | ~~22~~ | 23 | **~~24~~** | 25 | 26 | 27 | ~~28~~ | ~~29~~ |
| Open from | 08 | 08 | 08 | 08 | 08 | 09     | -      | 08 | -          | 08 | 08 | 08 | -      | -      |
| Open till | 20 | 20 | 20 | 20 | 20 | 12     | -      | 20 | -          | 20 | 20 | 20 | -      | -      |


#### Connector *class*

A connector is the socket or cable available for the EV to make use of. A single EVSE may provide multiple connectors but only one of them can be in use at the same time. A connector always belongs to an *EVSE* object.


| Property         | Type            | Card. | Description                                            |
|------------------|-----------------|-------|--------------------------------------------------------|
| id               | string(15)      | 1     | Identifier of the connector within the EVSE. Two connectors may have the same id as long as they do not belong to the same *EVSE* object. |
| standard         | ConnectorType   | 1     | The standard of the installed connector.               |
| format           | ConnectorFormat | 1     | The format (socket/cable) of the installed connector.  |
| power_type       | PowerType       | 1     |  |
| voltage          | int             | 1     | Voltage of the connector (line to neutral for AC_3_PHASE), in volt [V]. |
| amperage         | int             | 1     | maximum amperage of the connector, in ampere [A]. |
| price_schemes    | PricingScheme   | *     | URL to the operator's terms and conditions. |
| terms_and_conditions | URL         | ?     | URL to the operator's terms and conditions. |

##### Description

- string **id**: uniquely identifies the connector within the EVSE. Two connectors may have the same id as long as they do not belong to the same *EVSE* object.
- enum ConnectorType **type**: see *ConnectorType* specification in OCPP2.0
- enum ChargeProtocolType *charge_protocol*:
  - MODE3
  - CHADEMO
  - ISO15118
  - UNCONTROLLED
- enum PowerType **power_type**:
  - AC_1_PHASE
  - AC_3_PHASE
  - DC
- int **voltage**: voltage of the connector (line to neutral for AC_3_PHASE), in volt [V]
- int **amperage**: maximum amperage of the connector, in ampere [A]
- PricingScheme[] **price_schemes**: list of applicable price schemes (see *PriceScheme* specification in OCPP2.0)
- string *terms_and_contitions*: URL to the operator's terms and conditions


### Data objects

#### Location objects

The *Location* object describes the location and its properties where a group of EVSE's that belong together are installed. Typically the *Location* object is the exact location of the group of EVSE's, but it can also be the entrance of a parking garage which contains these EVSE's. The exact way to reach each EVSE can then be further specified by its own properties.

A *Location* without valid *EVSE* objects can be considered as expired and should no longer be displayed.

| Property         | Type         | Card. | Description                                            |
|------------------|--------------|-------|--------------------------------------------------------|
| id               | string(15)   | 1     | Uniquely identifies the location within the CPO's platform (and suboperator platforms). |
| name             | string(255)  | ?     | Display name of the location.                          |
| address          | string(45)   | 1     | Street/block name and house number if available.       |
| city             | string(45)   | 1     | City or town.                                          |
| zip_code         | string(10)   | 1     | Zip code of the location.                              |
| country          | string(3)    | 1     | ISO 3166-1 alpha-3 code for the country of this location. |
| latitude         | string(10)   | 1     | Latitude of the location in decimal format.            |
| longitude        | string(11)   | 1     | Longitude of the location in decimal format.           |
| directions       | string(255)  | ?     | Human-readable directions on how to reach the location. |
| operator         | Operator     | ?     | Information of the operator. When not specified, the information retreived from the `api_info` endpoint should be used instead. |
| suboperator      | Operator     | ?     | Information of the suboperator if available.           |
| operating_times  | Hours        | *     | The times when the EVSE's at the location can be used for charging. |


#### EVSE objects

The *EVSE* object describes the part that controls the power supply to a single EV in a single session. It always belongs to a *Location* object. It will only contain directions to get from the location to the EVSE (i.e. *floor*, *physical_number* or *directions*). When these properties are insufficient to reach the EVSE from the *Location* point, then it typically indicates that this EVSE should be put in a different *Location* object (sometimes with the same address but with different coordinates/directions).

An *EVSE* object has a list of connectors which can not be used simultaneously: only one connector per EVSE may be used at a time. The list of connectors is seen as atomic. This implies that for any changes or updates to a single connector, the full list of all connectors will have to be specified. Any connector not on that list is considered as deleted.

##### Format

| Property         | Type         | Card. | Description                                            |
|------------------|--------------|-------|--------------------------------------------------------|
| id               | string(48)   | 1     | Uniquely identifies the EVSE within the CPO's platform (and suboperator platforms). |
| location_id      | string(15)   | 1     | The id of the *Location* object that contains this EVSE. If the *Location* object does not exist, this EVSE may be discarded (and it should not have been sent in the first place). |
| status           | EVSEStatus     | 1     | Indicates the current status of the EVSE.            |
| capabilities     | EVSECapability | *     | List of functionalities that the EVSE is capable of. |
| connectors       | Connector      | +     | List of available connectors on the EVSE.            |
| floor_level      | string(4)      | ?     | Level on which the charging station is located (in garage buildings) in the locally displayed numbering scheme. |
| physical_number  | int            | ?     | A number on the EVSE for visual identification.      |
| directions       | string(255)    | ?     | Human-readable directions when more detailed information on how to reach the EVSE from the *Location* is required. |
| valid_from       | DateTime       | ?     | Describes when the EVSE becomes available. When this field is null, the EVSE has been made available. |
| valid_until      | DateTime       | ?     | Describes when the EVSE expires. When this field is null, the EVSE is not expired. |

